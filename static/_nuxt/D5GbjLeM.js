import{y as b,J as m,p as y,e as f,b as g,M as k,h as v,O as w,t as d,K as l,P as S}from"./CRmxgdnc.js";import{E as R}from"./Kxbf7TY_.js";import{resolveYouTubeVideoId as T}from"./CA6XwpqT.js";import"./DgNqPJO3.js";import"./DvzNCXfJ.js";import"./BqsLdWV1.js";const o={Om:-1,pg:0,qg:1,gj:2,hj:3,ij:5};class E extends R{constructor(e,t){super(e),this.b=t,this.$$PROVIDER_TYPE="YOUTUBE",this.scope=b(),this.ha=m(""),this.za=-1,this.K=null,this.md=-1,this.vc=!1,this.Rn=new Map,this.language="en",this.color="red",this.cookies=!1}get c(){return this.b.delegate.c}get currentSrc(){return this.K}get type(){return"youtube"}get videoId(){return this.ha()}preconnect(){y(this.Nb())}setup(){super.setup(),f(this.we.bind(this)),this.c("provider-setup",this)}destroy(){this.z();const e="provider destroyed";for(const t of this.Rn.values())for(const{reject:s}of t)s(e);this.Rn.clear()}async play(){return this.t("playVideo")}Hn(e){var t;(t=this.Sn("playVideo"))==null||t.reject(e)}async pause(){return this.t("pauseVideo")}In(e){var t;(t=this.Sn("pauseVideo"))==null||t.reject(e)}setMuted(e){e?this.t("mute"):this.t("unMute")}setCurrentTime(e){this.vc=this.b.$state.paused(),this.t("seekTo",e),this.c("seeking",e)}setVolume(e){this.t("setVolume",e*100)}setPlaybackRate(e){this.t("setPlaybackRate",e)}async loadSource(e){if(!g(e.src)){this.K=null,this.ha.set("");return}const t=T(e.src);this.ha.set(t??""),this.K=e}Nb(){return this.cookies?"https://www.youtube.com":"https://www.youtube-nocookie.com"}we(){this.z();const e=this.ha();if(!e){this.sc.set("");return}this.sc.set(`${this.Nb()}/embed/${e}`),this.c("load-start")}mg(){const{keyDisabled:e}=this.b.$props,{muted:t,playsInline:s,nativeControls:i}=this.b.$state,a=i();return{autoplay:0,cc_lang_pref:this.language,cc_load_policy:a?1:void 0,color:this.color,controls:a?1:0,disablekb:!a||e()?1:0,enablejsapi:1,fs:1,hl:this.language,iv_load_policy:a?1:3,mute:t()?1:0,playsinline:s()?1:0}}t(e,t){let s=k(),i=this.Rn.get(e);return i||this.Rn.set(e,i=[]),i.push(s),this.se({event:"command",func:e,args:t?[t]:void 0}),s.promise}gd(){window.setTimeout(()=>this.se({event:"listening"}),100)}kd(e){this.c("loaded-metadata"),this.c("loaded-data"),this.b.delegate.Ga(void 0,e)}ib(e){var t;(t=this.Sn("pauseVideo"))==null||t.resolve(),this.c("pause",void 0,e)}mc(e,t){const{duration:s,realCurrentTime:i}=this.b.$state,a=this.za===o.pg,h=a?s():e;this.c("time-change",h,t),!a&&Math.abs(h-i())>1&&this.c("seeking",h,t)}nb(e,t,s){const i={buffered:new l(0,e),seekable:t};this.c("progress",i,s);const{seeking:a,realCurrentTime:h}=this.b.$state;a()&&e>h()&&this.ob(s)}ob(e){const{paused:t,realCurrentTime:s}=this.b.$state;window.clearTimeout(this.md),this.md=window.setTimeout(()=>{this.c("seeked",s(),e),this.md=-1},t()?100:0),this.vc=!1}lc(e){const{seeking:t}=this.b.$state;t()&&this.ob(e),this.c("pause",void 0,e),this.c("end",void 0,e)}ie(e,t){var u;const{started:s,paused:i,seeking:a}=this.b.$state,h=e===o.qg,n=e===o.hj,r=!v(this.Sn("playVideo")),c=(i()||r)&&(n||h);if(n&&this.c("waiting",void 0,t),a()&&h&&this.ob(t),!s()&&c&&this.vc){this.Hn("invalid internal play operation"),h&&(this.pause(),this.vc=!1);return}switch(c&&((u=this.Sn("playVideo"))==null||u.resolve(),this.c("play",void 0,t)),e){case o.Om:this.Hn("provider rejected"),this.In("provider rejected"),this.c("pause",void 0,t);break;case o.ij:this.kd(t);break;case o.qg:this.c("playing",void 0,t);break;case o.gj:this.ib(t);break;case o.pg:this.lc(t);break}this.za=e}te({info:e},t){var h;if(!e)return;const{title:s,intrinsicDuration:i,playbackRate:a}=this.b.$state;if(w(e.videoData)&&e.videoData.title!==s()&&this.c("title-change",e.videoData.title,t),d(e.duration)&&e.duration!==i()){if(d(e.videoLoadedFraction)){const n=((h=e.progressState)==null?void 0:h.loaded)??e.videoLoadedFraction*e.duration,r=new l(0,e.duration);this.nb(n,r,t)}this.c("duration-change",e.duration,t)}if(d(e.playbackRate)&&e.playbackRate!==a()&&this.c("rate-change",e.playbackRate,t),e.progressState){const{current:n,seekableStart:r,seekableEnd:c,loaded:u,duration:p}=e.progressState;this.mc(n,t),this.nb(u,new l(r,c),t),p!==i()&&this.c("duration-change",p,t)}if(d(e.volume)&&S(e.muted)){const n={muted:e.muted,volume:e.volume/100};this.c("volume-change",n,t)}d(e.playerState)&&e.playerState!==this.za&&this.ie(e.playerState,t)}z(){this.za=-1,this.md=-1,this.vc=!1}Sn(e){var t;return(t=this.Rn.get(e))==null?void 0:t.shift()}}export{E as YouTubeProvider};
